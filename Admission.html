<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="../images/logo.png">

    <title>Ketsleigh Primary School Admission</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">

    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico">


</head>
<style>
    h2 {
        text-align: center;
        color: #333;
    }

    label {
        display: block;
        margin-bottom: 8px;
        color: #555;
    }

    input[type="text"] {
        padding: 10px;
        margin-bottom: 15px;
        border: 1px solid #ccc;
        border-radius: 5px;
    }

    button {
        padding: 10px;
        background-color: #007bff;
        color: #fff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
    }

    button:hover {
        background-color: #a78913;
    }

    .status-container {
        margin-top: 20px;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        background-color: #e7f3fe;
        display: none;
        /* Initially hidden */
    }

    .error {
        color: red;
        margin-top: 10px;
    }
</style>




<body data-aos="fade-up" data-aos-delay="600">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <img src="./images/Keitsleighschool-logo.png.png" alt="School Logo">
            </a>
            <button class="navbar-toggler custom-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarNav">
                <span><i class="fa-solid fa-bars"></i></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link " href="index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link  " href="AboutUs.html">About Us</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="Academic.html">Academics</a>
                    </li>

                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle active" href="#" id="admissionDropdown" role="button"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            Admission
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="admissionDropdown">
                            <li><a class="dropdown-item" href="Admission.html">Apply Now</a></li>

                            <li>
                                <a class="dropdown-item" href="#" data-bs-toggle="modal"
                                    data-bs-target="#trackApplicationModal">
                                    Track Application
                                </a>
                            </li>
                        </ul>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" href="Gallery.html">Gallery</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="Sport.html">Sport</a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" href="fees.html">Fees</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="ContactUs.html">Contact Us</a>
                    </li>
                    <!-- Enroll Now Button -->
                    <li class="nav-item">
                        <a class="btn" href="Admission.html"
                            style="background-color: #0900FF; color: white; border-radius: 50px; font-weight: bold; border: none; transition: background-color 0.3s, transform 0.3s;">
                            Enrol Now
                        </a>
                    </li>

                </ul>
                <span class="contact-number ms-3">
                    <i class="fas fa-phone-alt"></i> 031 201 8014
                </span>
            </div>
        </div>
    </nav>




    <div class="Containerss" style="margin-top: 100px;">
        <h2>Ketsleigh Application Form</h2>
        <!-- Countdown to application closure -->
        <div id="countdownContainer" class="countdown-container">
            <div class="countdown-message">
                <h4>Application Closing In:</h4>
                <div id="countdown" class="countdown-timer"></div>
            </div>
        </div>





        <ul class="progress-bars">
            <li class="progress-step active" id="stepAgreement">Agreement</li>
            <li class="progress-step" id="stepParent">Parent</li>
            <li class="progress-step" id="stepLearner">Learner</li>
            <li class="progress-step" id="stepTrack">Track</li>
            <li class="progress-step" id="stepSubmitted">Submitted</li>
        </ul>


        <!-- Agreement Section -->
        <div id="agreementSection" class="form-section active">

            <div class="caution-notice">
                <ul>
                    <li>
                        <span class="caution-icon">&#9888;</span>
                        <div>
                            <strong>Please note:</strong> The application will close on
                            <strong id="deadlineMessage"></strong>. Please ensure you complete the form before the
                            deadline.
                        </div>
                    </li>
                </ul>
            </div>


            <h3>Agreement</h3>
            <p>Please review and agree to the following requirements before proceeding with the application:</p>
            <ul>
                <li>Admissions for 2025 are now open.</li>
                <li>All new applicants are obliged to complete and pass an assessment.</li>
                <li>You are required to arrive with the learner between 8:00 and 08:30am for assessment.</li>
                <li>Assessment days are Tuesdays, Wednesdays, or Thursdays.</li>
                <li>Application forms will be availed to you after the assessment.</li>
                <li>A non-refundable application fee of R400.00 must accompany this application.</li>
                <li><strong>NB:</strong> No assessment will be carried out without copies of all the required documents.
                </li>
                <li>Your child must turn 5 before 30 June 2025 for admission to Grade R (No exceptions).</li>
                <li>Your child must turn 6 before 30 June 2025 for admission to Grade 1 (No exceptions).</li>
            </ul>

            <p><strong>PLEASE NOTE:</strong> APPLICATIONS WILL NOT BE PROCESSED SHOULD DOCUMENTATION BE INCOMPLETE. All
                DOCUMENTS
                MUST BE CERTIFIED.</p>
            <ul>
                <li>Copy of your child’s Birth Certificate</li>
                <li>Copy of your child’s study permit (Foreign Nationals)</li>
                <li>Copy of Immunization Card</li>
                <li>Copy of Latest Report (September 2024)</li>
                <li>Copy of previous assessments (medical, educational)</li>
                <li>Copy of Financial Clearance Letter OR Transfer Card</li>
                <li>Copy of Proof of Residence/Address</li>
                <li>Copy of both Parents/Guardian ID books</li>
                <li>Copy of Parent’s/Guardian’s Salary advice (3 recent pay-slips)</li>
                <li>Copy of Parent’s/Guardian’s 3 months Bank Statement (Self-employed)</li>
                <li>Passport size photo of learner (recent)</li>
            </ul>
            <div style="margin-top: 20px;">
                <a href="FEES Doc.pdf" download="Fees2025.pdf" id="downloadFeesButton" class="btn btn-primary">
                    <i class="fas fa-file-pdf" style="color: red; margin-right: 10px;"></i> Download
                </a>
            </div>



            <p>
                By proceeding, you confirm that you have read, understood, and agreed to the above requirements.
            </p>


            <label>
                <input type="checkbox" id="agreementCheckbox" onclick="toggleNextButton()">
                <strong>I have read and agree to the terms and requirements above.</strong>
            </label>



            <div class="button-container">
                <button type="button" id="nextButton" class="button next" disabled
                    onclick="showNextSection('parentForm')">Next</button>
            </div>
        </div>

        <!-- Parent/Guardian Form Section -->
        <div id="parentForm" class="form-section ">
            <h3>Parent/Guardian Information</h3>
            <form id="parentFormData">
                <label for="parentName">Parent/Guardian Name</label>
                <input type="text" id="parentName" name="parentName" placeholder="Full Name" required>

                <label for="parentID">ID Number</label>
                <input type="number" id="parentID" name="parentID" oninput="enforceMaxLength(event)"
                    placeholder="Enter 13-digit ID" required>
                <div id="idError" style="color: red;"></div>

                <label for="parentEmail">Email</label>
                <input type="email" id="parentEmail" name="parentEmail" placeholder="e.g. parent@example.com" required>

                <label for="parentPhone">Phone Number</label>
                <input type="text" id="parentPhone" name="parentPhone" placeholder="0XXXXXXXXX" maxlength="10"
                    oninput="validateParentPhone()" required>
                <div id="phoneError" style="color: red;"></div>

                <label for="Paddress">Address</label>
                <input type="text" id="Paddress" name="Paddress" placeholder="Home Address" required>

                <label for="parentDoc">Copy of both Parents/Guardian ID books</label>
                <input type="file" id="parentDoc" name="parentDoc" accept="image/*">
                <label for="proofOfAddressFile">Copy of Proof of Residence/Address</label>
                <input type="file" id="proofOfAddressFile" name="proofOfAddressFile" accept="image/*">

                <label for="salaryAdviceFile">Copy of Parent’s/Guardian’s Salary advice (3 recent Pay-slips)</label>
                <input type="file" id="salaryAdviceFile" name="salaryAdviceFile" accept="image/*">

                <label for="bankStatementFile">Copy of Parent’s/Guardian’s 3 months Bank Statement
                    (Self-employed)</label>
                <input type="file" id="bankStatementFile" name="bankStatementFile" accept="image/*">
                <p class="note-text">Take Note: Please Upload Images Only!</p>

                <div class="button-container">
                    <button type="button" class="button prev"
                        onclick="showPrevSection('agreementSection')">Previous</button>

                    <button type="button" class="button next" onclick="validateParentForm()">Next</button>

                </div>

            </form>
            <div id="formErrors" style="color: red; margin-top: 10px;"></div>

        </div>

        <!-- Learner Form Section -->
        <div id="learnerForm" class="form-section">
            <h3>Learner Information</h3>
            <form id="learnerFormData">

                <label for="Fname">First Name</label>
                <input type="text" id="Fname" name="Fname" required>

                <label for="Sname">Second Name</label>
                <input type="text" id="Sname" name="Sname">

                <label for="Surname">Surname</label>
                <input type="text" id="Surname" name="Surname" required>

                <label for="LearnerID">ID Number</label>
                <input type="text" id="LearnerID" placeholder="Enter 13-digit Learner ID" maxlength="13"
                    oninput="updateLearnerDob()" required>

                <div id="learnerIdMessage" style="color: red;"></div>
                <label for="learnerDob">Date of Birth</label>

                <input type="date" id="learnerDob" name="learnerDob" readonly>


                <label for="learnerIDCard">Copy of your child’s Birth Certificate</label>
                <input type="file" id="learnerIDCard" name="learnerIDCard" accept="image/*" required>

                <label for="learnerGrade">Grade Applying For</label>
                <select id="learnerGrade" style="width: 200px;" name="learnerGrade" required>
                    <option value="" disabled selected>Select a grade</option>
                                        <option value="1">Grade R</option>
                    <option value="2">Grade 1</option>
                    <option value="3">Grade 2</option>
                    <option value="4">Grade 3</option>

                    <option value="5">Grade 4</option>
                    <option value="6">Grade 5</option>
                    <option value="7">Grade 6</option>
                    <option value="8">Grade 7</option>
                </select>
                <label for="previousSchoolRemoval">Removal from Previous School</label>
                <input type="file" id="previousSchoolRemoval" name="previousSchoolRemoval" accept="image/*" required>

                <label for="Gender">Gender</label>
                <select id="Gender" style="width: 200px;" name="Gender" required>
                    <option value="" disabled selected>Select a Gender</option>
                    <option value="Male">Male </option>
                    <option value="Female">Female </option>

                </select>


                <!-- Study Permit Field -->
                <div class="input-group">
                    <label for="studyPermitFile">Copy of your child’s study permit (Foreign Nationals)</label>
                    <input type="file" id="studyPermitFile" name="studyPermitFile" accept="image/*"
                        placeholder="Optional if outside country">
                    <small class="form-text text-muted" style="color: #d9534f; margin-top: 5px;">
                        <strong>Note:</strong> Providing a falsified permit will result in legal action.
                    </small>
                </div>


                <label for="immunizationCardFile">Copy of Immunization Card</label>
                <input type="file" id="immunizationCardFile" name="immunizationCardFile" accept="image/*">

                <label for="reportCard">Upload Report(September 2024)</label>
                <input type="file" id="reportCard" name="reportCard" accept="image/*" required>


                <label for="previousAssessmentsFile">Copy of previous assessments (medical, educational)</label>
                <input type="file" id="previousAssessmentsFile" name="previousAssessmentsFile" accept="image/*">

                <label for="financialClearanceFile">Copy of Financial Clearance Letter OR Transfer Card</label>
                <input type="file" id="financialClearanceFile" name="financialClearanceFile" accept="image/*">


                <label for="passportPhotoFile">Passport size photo of learner (recent)</label>
                <input type="file" id="passportPhotoFile" name="passportPhotoFile" accept="image/*">
                <p class="note-text">Take Note: Please Upload Images Only!</p>


                <div class="button-container">
                    <button type="button" class="button prev" onclick="showPrevSection('parentForm')">Previous</button>

                    <button type="button" class="button next" id="nextButton"
                        onclick="validateLearnerForm()">Next</button>
                </div>


            </form>
            <div id="learnerFormErrors" style="color: red; margin-top: 10px;"></div>

        </div>

        <!-- Submit Section -->
        <div id="emailSection" class="form-section">
            <h3>Track Your Application</h3>
            <form id="trackingForm">
                <label for="trackingEmail">Enter Your Email</label>
                <input type="email" id="trackingEmail" name="trackingEmail" required>

                <div class="button-container">
                    <button type="button" class="button prev" onclick="showPrevSection('learnerForm')">Previous</button>
                    <button type="submit" id="submitButton" class="button save">Save & Submit</button>

                </div>
            </form>
        </div>



    </div>
    <!-- Application Closed Modal -->
    <div id="closedOverlay" class="closed-overlay" style="display: none;">
        <div class="closed-message">
            <h4><span style="color: red;">&#10060;</span> Application Closed</h4>
            <p>The application has closed as of <strong id="closedDate"></strong>. You can no longer proceed with this
                form.</p>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="trackApplicationModal" tabindex="-1" aria-labelledby="trackApplicationModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="trackApplicationModalLabel">Admission Status Tracker</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <label for="trackNumber">Enter Learner ID or Registration Number</label>
                    <input type="text" id="trackNumber" placeholder="Learner ID or Registration Number" required>
                    <button id="trackButton" onclick="trackStatus()">Track Status</button>

                    <div class="status-container" id="statusContainer">
                        <h3>Status:</h3>
                        <p id="statusMessage"></p>
                        <p class="error" id="errorMessage"></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div id="footer"></div>
    <script src="footer.js"></script>
    <!-- Bootstrap JS and Popper.js -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", async function () {
            const deadlineMessage = document.getElementById("deadlineMessage");
            const closedDate = document.getElementById("closedDate");
            const countdownElement = document.getElementById("countdown");
            const countdownContainer = document.getElementById("countdownContainer");
            const closedOverlay = document.getElementById("closedOverlay");

            let deadlineDate;

            // Fetch closing date from backend
            async function fetchClosingDate() {
                try {
                    const response = await fetch('https://kzdsolutions.co.za/api/application-closing-date');
                    if (!response.ok) {
                        throw new Error('Failed to fetch closing date');
                    }
                    const data = await response.json();
                    deadlineDate = data.closingDate ? new Date(data.closingDate) : null;
                } catch (error) {
                    console.error('Error fetching closing date:', error);
                    deadlineDate = null; // Set to null if there's an error
                }
            }

            // Display deadline message
            function displayDeadline() {
                if (deadlineDate) {
                    const formattedDate = deadlineDate.toLocaleDateString("en-US", {
                        year: "numeric",
                        month: "long",
                        day: "numeric",
                    });

                    deadlineMessage.textContent = formattedDate;
                    closedDate.textContent = formattedDate;
                } else {
                    countdownContainer.style.display = "none"; // Hide countdown if no deadline
                }
            }

            // Countdown function
            function startCountdown() {
                if (deadlineDate) {
                    const interval = setInterval(() => {
                        const now = new Date().getTime();
                        const timeLeft = deadlineDate - now;

                        if (timeLeft > 0) {
                            const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
                            const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                            const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                            const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

                            countdownElement.textContent = `${days}d ${hours}h ${minutes}m ${seconds}s`;
                        } else {
                            // Time has run out
                            clearInterval(interval);
                            countdownContainer.style.display = "none"; // Hide countdown
                            closedOverlay.style.display = "flex"; // Show overlay
                            disableForm();
                        }
                    }, 1000);
                }
            }

            // Enable only the application forms
            function enableForms() {
                const formSections = document.querySelectorAll(".form-section input, .form-section button, .form-section select");
                formSections.forEach((input) => {
                    input.disabled = false; // Enable each input field within the form sections
                });
            }

            // Disable only the application forms if deadline passed
            function disableForm() {
                const formSections = document.querySelectorAll(".form-section input, .form-section button, .form-section select");
                formSections.forEach((input) => {
                    input.disabled = true; // Disable form fields in the application sections
                });
            }

            // Initialize
            await fetchClosingDate();
            if (deadlineDate) {
                displayDeadline();
                startCountdown();
            } else {
                enableForms(); // Enable only the application form sections if no deadline
            }
        });

        // Function to enable/disable "Next" button based on checkbox state
        function toggleNextButton() {
            const checkbox = document.getElementById('agreementCheckbox');
            const nextButton = document.getElementById('nextButton');
            if (checkbox.checked) {
                nextButton.disabled = false;
                nextButton.style.backgroundColor = "#3498db";
            } else {
                nextButton.disabled = true;
                nextButton.style.backgroundColor = "gray";
            }
        }
    </script>


    <script>
        // Handle form submission
        document.getElementById("trackingForm").addEventListener("submit", async function (event) {
            event.preventDefault(); // Prevent default form submission

            const submitButton = document.getElementById("submitButton");

            // Disable the submit button to prevent multiple submissions
            submitButton.disabled = true;
            submitButton.textContent = "Processing...";

            const email = document.getElementById("trackingEmail").value;

            // Validate email format
            if (!validateEmail(email)) {
                alert("Please enter a valid email address.");
                resetButton();
                return;
            }

            // Retrieve parentData and learnerData from sessionStorage
            const parentData = JSON.parse(sessionStorage.getItem("parentData")) || {};
            const learnerData = JSON.parse(sessionStorage.getItem("learnerData")) || {};

            // Check if parentData and learnerData contain the necessary fields
            const { parentId } = parentData;
            const { learnerId } = learnerData;

            if (!parentId || !learnerId) {
                alert("Parent ID or Learner ID is missing. Please ensure that both forms have been filled out correctly.");
                resetButton();
                return;
            }

            // Fetch file inputs from learner form
            const reportCardFile = document.getElementById("reportCard").files[0];
            const previousSchoolRemovalFile = document.getElementById("previousSchoolRemoval").files[0];
            const learnerIDCardFile = document.getElementById("learnerIDCard").files[0];
            const parentDocFile = document.getElementById("parentDoc").files[0];
            const financialClearanceFile = document.getElementById('financialClearanceFile').files[0];
            const immunizationCardFile = document.getElementById('immunizationCardFile').files[0];
            const passportPhotoFile = document.getElementById('passportPhotoFile').files[0];
            const previousAssessmentsFile = document.getElementById('previousAssessmentsFile').files[0];
            const studyPermitFile = document.getElementById('studyPermitFile').files[0];


            const proofOfAddressFile = document.getElementById('proofOfAddressFile').files[0];
            const salaryAdviceFile = document.getElementById('salaryAdviceFile').files[0];
            const bankStatementFile = document.getElementById('bankStatementFile').files[0];

            // Create FormData object
            const formData = new FormData();
            formData.append("trackingEmail", email);
            formData.append("parentId", parentId);
            formData.append("learnerId", learnerId);

            // Append files to FormData
            if (parentDocFile) formData.append("parentDoc", parentDocFile);
            if (reportCardFile) formData.append("reportCard", reportCardFile);
            if (previousSchoolRemovalFile) formData.append("previousSchoolRemoval", previousSchoolRemovalFile);
            if (learnerIDCardFile) formData.append("learnerIDCard", learnerIDCardFile);


            if (financialClearanceFile) formData.append("financialClearanceFile", financialClearanceFile);
            if (immunizationCardFile) formData.append("immunizationCardFile", immunizationCardFile);
            if (previousAssessmentsFile) formData.append("previousAssessmentsFile", previousAssessmentsFile);
            if (studyPermitFile) formData.append("studyPermitFile", studyPermitFile);
            if (passportPhotoFile) formData.append("passportPhotoFile", passportPhotoFile);

            if (proofOfAddressFile) formData.append("proofOfAddressFile", proofOfAddressFile);
            if (bankStatementFile) formData.append("bankStatementFile", bankStatementFile);
            if (salaryAdviceFile) formData.append("salaryAdviceFile", salaryAdviceFile);

            // Append parentData and learnerData as JSON strings
            formData.append("parentData", JSON.stringify(parentData));
            formData.append("learnerData", JSON.stringify(learnerData));

            // Send the form data to the server
            try {
                const response = await fetch("https://kzdsolutions.co.za/register", {
                    method: "POST",
                    body: formData, // Send FormData directly
                });

                const data = await response.json();
                if (response.ok) {
                    sessionStorage.clear(); // Clear session storage
                    document.getElementById("parentFormData").reset();
                    document.getElementById("learnerFormData").reset();
                    document.getElementById("trackingForm").reset();

                    window.location.href = 'thank.html';
                } else {
                    alert(`Error: ${data.message}`);
                }
            } catch (error) {
                console.error("Error:", error);
                alert("Please be patient. The system is currently down. For assistance, please email the administrator. Please try again.");
            } finally {
                // Reset button after processing
                resetButton();
            }
        });

        // Reset button to its original state
        function resetButton() {
            const submitButton = document.getElementById("submitButton");
            submitButton.disabled = false;
            submitButton.textContent = "Save & Submit";
        }
    </script>



    <script>


        // Function to show the next section
        function showNextSection(sectionId) {
            const sections = document.querySelectorAll('.form-section');
            sections.forEach(section => section.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');

            if (sectionId === 'learnerForm') {
                loadParentData(); // Load parent data when showing learner form
            } else if (sectionId === 'emailSection') {
                setTrackingEmail(); // Set tracking email when showing email section
            }
        }
        // Helper function to validate email format
        function validateEmail(email) {
            const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailPattern.test(email);
        }

        function validateParentPhone() {
            const phoneInput = document.getElementById('parentPhone');
            const phoneError = document.getElementById('phoneError');

            const phoneValue = phoneInput.value;

            // Clear error messages initially
            phoneError.innerHTML = '';

            // Allow only digits and enforce length limit
            if (!/^\d*$/.test(phoneValue)) {
                phoneError.innerHTML = 'Phone number can only contain digits.';
                phoneInput.value = phoneValue.slice(0, -1); // Remove last non-digit character
                return;
            }

            // Ensure it starts with 0
            if (phoneValue.length > 0 && phoneValue[0] !== '0') {
                phoneError.innerHTML = 'Phone number must start with 0.';
                phoneInput.value = ''; // Clear invalid input
                return;
            }

            // Lock the input if 10 digits are entered
            if (phoneValue.length === 10) {
                phoneInput.readOnly = true; // Make the input read-only
                phoneError.innerHTML = ''; // Clear any previous errors
            } else {
                phoneInput.readOnly = false; // Allow editing until 10 digits
            }
        }


        function enforceMaxLength(event) {
            const input = event.target;

            // Limit the input length to 13 digits
            if (input.value.length > 13) {
                input.value = input.value.slice(0, 13); // Truncate to 13 digits
            }
        }

        // Function to validate parent form
        function validateParentForm() {
            const errorContainer = document.getElementById('formErrors');
            const phoneError = document.getElementById('phoneError');
            errorContainer.innerHTML = ''; // Clear previous errors
            phoneError.innerHTML = ''; // Clear phone-specific errors
            const idError = document.getElementById('idError');
            idError.innerHTML = ''; // Clear ID-specific errors
            // Get form field values
            const parentName = document.getElementById('parentName').value.trim();
            const parentEmail = document.getElementById('parentEmail').value.trim();
            const parentPhone = document.getElementById('parentPhone').value.trim();
            const Paddress = document.getElementById('Paddress').value.trim();
            const parentID = document.getElementById('parentID').value.trim();

            // Get file elements from DOM
            const parentDoc = document.getElementById('parentDoc').value.trim(); // Get the file object

            const proofOfAddressFile = document.getElementById('proofOfAddressFile').value.trim();
            const salaryAdviceFile = document.getElementById('salaryAdviceFile').value.trim();
            const bankStatementFile = document.getElementById('bankStatementFile').value.trim();


            let isValid = true;



            if (!parentName) {
                errorContainer.innerHTML += 'Please enter the Parent/Guardian Name.<br>';
                isValid = false;
            }

            // Validate email
            if (!parentEmail || !validateEmail(parentEmail)) {
                errorContainer.innerHTML += 'Please enter a valid email address.<br>';
                isValid = false;
            } else {
                // Set tracking email if parentEmail is valid
                setTrackingEmail(parentEmail);
            }

            // Validate Phone Number
            if (!/^0\d{9}$/.test(parentPhone)) {
                phoneError.innerHTML = 'Phone number must be 10 digits and start with 0.';
                isValid = false;
            }

            // Validate Address
            if (!Paddress) {
                errorContainer.innerHTML += 'Please enter the Address.<br>';
                isValid = false;
            }

            // Validate if document is uploaded
            if (!parentDoc) {
                errorContainer.innerHTML += 'Please upload the Parents/Guardian ID Books .<br>';
                isValid = false;
            }

            if (!salaryAdviceFile) {
                errorContainer.innerHTML += 'Please upload the Salary Advice File Document .<br>';
                isValid = false;
            }


            if (!bankStatementFile) {
                errorContainer.innerHTML += 'Please upload the Bank Statement File Document .<br>';
                isValid = false;
            }


            if (!proofOfAddressFile) {
                errorContainer.innerHTML += 'Please upload the Proof Of Address File Document .<br>';
                isValid = false;
            }

            // Validate 13-digit ID Number
            if (!/^\d{13}$/.test(parentID)) {
                idError.innerHTML = 'ID Number must be exactly 13 digits.';
                isValid = false;
            }


            const allowedFileTypes = ['image/jpeg', 'image/png', 'image/jpg'];




            // If form is valid, proceed to the next section
            if (isValid) {
                // Store parent data in a single object
                const parentData = {
                    parentId: parentID,
                    parentName: parentName,
                    parentEmail: parentEmail,
                    parentPhone: parentPhone,
                    Paddress: Paddress
                };

                // Save parentData to sessionStorage
                sessionStorage.setItem('parentData', JSON.stringify(parentData));

                // Clear error messages
                errorContainer.innerHTML = '';

                // Proceed to next section
                showNextSection('learnerForm');
            }
        }


        function checkLearnerID() {
            const learnerId = document.getElementById('LearnerID').value;
            const messageDiv = document.getElementById('learnerIdMessage');
            const nextButton = document.getElementById('nextButton');

            if (learnerId) {
                return fetch('https://kzdsolutions.co.za/check-learner-id', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ learnerId }),
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.exists) {
                            // Learner ID exists
                            messageDiv.innerHTML = `The learner ID is already applied. Current status: ${data.status}`;
                            messageDiv.style.color = 'red';
                            nextButton.disabled = true; // Disable the Next button
                            return false; // Invalid learner ID
                        } else {
                            // Learner ID is valid
                            messageDiv.innerHTML = '';
                            nextButton.disabled = false; // Enable the Next button
                            return true; // Valid learner ID
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        messageDiv.innerHTML = 'An error occurred while checking the learner ID.';
                        messageDiv.style.color = 'red';
                        nextButton.disabled = true; // Disable the Next button
                        return false; // Treat as invalid in case of error
                    });
            } else {
                // Learner ID field is empty
                messageDiv.innerHTML = 'Please enter a learner ID.';
                messageDiv.style.color = 'red';
                nextButton.disabled = true; // Disable the Next button
                return Promise.resolve(false); // Invalid learner ID
            }
        }

        // Function to invalidate the learner form
        function invalidateLearnerForm() {
            const errorContainer = document.getElementById('learnerFormErrors');
            errorContainer.innerHTML = 'The learner ID already exists. Please check and try again.';
        }

        // Function to update the Date of Birth based on Learner ID
        function updateLearnerDob() {
            const learnerID = document.getElementById('LearnerID').value.trim();
            const learnerDob = document.getElementById('learnerDob');
            const learnerIdMessage = document.getElementById('learnerIdMessage');

            // Clear error messages
            learnerIdMessage.textContent = '';

            // Check if at least the first 6 digits are entered
            if (learnerID.length >= 6) {
                const yearPrefix = parseInt(learnerID.slice(0, 2)) < 50 ? '20' : '19'; // IDs < 50 are from 2000s
                const year = yearPrefix + learnerID.slice(0, 2);
                const month = learnerID.slice(2, 4);
                const day = learnerID.slice(4, 6);

                // Check if the extracted date is valid
                if (isValidDate(year, month, day)) {
                    learnerDob.value = `${year}-${month}-${day}`; // Set date in YYYY-MM-DD format
                } else {
                    learnerDob.value = ''; // Clear the field if invalid
                    learnerIdMessage.textContent = 'Invalid Date. Check the Learner ID.';
                }
            } else {
                learnerDob.value = ''; // Clear the field if ID is too short
            }
        }

        // Helper function to validate a date
        function isValidDate(year, month, day) {
            const date = new Date(`${year}-${month}-${day}`);
            return (
                date.getFullYear() === parseInt(year) &&
                date.getMonth() + 1 === parseInt(month) && // JS months are 0-indexed
                date.getDate() === parseInt(day)
            );
        }

        // Function to validate learner form
        async function validateLearnerForm() {
            const errorContainer = document.getElementById('learnerFormErrors');
            errorContainer.innerHTML = ''; // Clear previous errors

            const Fname = document.getElementById('Fname').value.trim();
            const Sname = document.getElementById('Sname').value.trim();
            const Surname = document.getElementById('Surname').value.trim();
            const LearnerID = document.getElementById('LearnerID').value.trim();
            const learnerDob = document.getElementById('learnerDob').value.trim();
            const learnerGrade = document.getElementById('learnerGrade').value.trim();

            const reportCard = document.getElementById('reportCard').value.trim();;
            const previousSchoolRemoval = document.getElementById('previousSchoolRemoval').value.trim();;
            const learnerIDCard = document.getElementById('learnerIDCard').value.trim();;
            const gender = document.getElementById('Gender').value.trim();

            const financialClearanceFile = document.getElementById('financialClearanceFile').value.trim();;
            const immunizationCardFile = document.getElementById('immunizationCardFile').value.trim();;
            const passportPhotoFile = document.getElementById('passportPhotoFile').value.trim();;
            const previousAssessmentsFile = document.getElementById('previousAssessmentsFile').value.trim();;
            const studyPermitFile = document.getElementById('studyPermitFile').value.trim();;


            let isValid = true;

            if (!Fname) {
                errorContainer.innerHTML += 'Please enter the First Name.<br>';
                isValid = false;
            }

            if (!Surname) {
                errorContainer.innerHTML += 'Please enter the Surname.<br>';
                isValid = false;
            }

            if (!gender) {
                errorContainer.innerHTML += 'Please Select the Gender.<br>';
                isValid = false;
            }

            // Validate Learner ID and Date of Birth
            if (!/^\d{13}$/.test(LearnerID)) {
                errorContainer.innerHTML += 'Learner ID Number must be a 13-digit number.<br>';
                isValid = false;
            } else if (!learnerDob) {
                errorContainer.innerHTML += 'Learner Date of Birth could not be determined. Please check the Learner ID.<br>';
                isValid = false;
            }

            if (!learnerGrade) {
                errorContainer.innerHTML += 'Please select the Grade.<br>';
                isValid = false;
            }

            if (!reportCard) {
                errorContainer.innerHTML += 'Please upload the Report.<br>';
                isValid = false;
            }


            if (!previousSchoolRemoval) {
                errorContainer.innerHTML += 'Please upload the Removal Document.<br>';
                isValid = false;
            }

            if (!learnerIDCard) {
                errorContainer.innerHTML += 'Please upload the Birth Certificate File  Document.<br>';
                isValid = false;
            }

            if (!immunizationCardFile) {
                errorContainer.innerHTML += 'Please upload the Immunization Card File Document.<br>';
                isValid = false;
            }

            if (!previousAssessmentsFile) {
                errorContainer.innerHTML += 'Please upload the Previous Assessments File Document.<br>';
                isValid = false;
            }
            if (!financialClearanceFile) {
                errorContainer.innerHTML += 'Please upload the financial Clearance File Document.<br>';
                isValid = false;
            }

            if (!passportPhotoFile) {
                errorContainer.innerHTML += 'Please upload the Passport Photo File Document.<br>';
                isValid = false;
            }


            // Check learner ID asynchronously
            const isLearnerIDValid = await checkLearnerID();
            if (!isLearnerIDValid) {
                isValid = false;
            }

            const allowedFileTypes = ['image/jpeg', 'image/png', 'image/jpg'];


            // If the form is valid, proceed to the next section
            if (isValid) {
                // Store learner data in a single object
                const learnerData = {
                    learnerId: LearnerID,
                    Fname: Fname,
                    Sname: Sname,
                    Surname: Surname,
                    learnerDob: learnerDob,
                    learnerGrade: learnerGrade,
                    gender: gender,

                };
                sessionStorage.setItem('learnerData', JSON.stringify(learnerData)); // Store as a JSON string
                showNextSection('emailSection');
            }
        }


        // Function to load parent data from sessionStorage
        function loadParentData() {
            // Retrieve parent data from sessionStorage
            const parentData = JSON.parse(sessionStorage.getItem('parentData'));

            if (parentData) {
                // Populate fields with stored parent data
                document.getElementById('parentName').value = parentData.parentName;
                document.getElementById('parentEmail').value = parentData.parentEmail;
                document.getElementById('parentPhone').value = parentData.parentPhone;
                document.getElementById('Paddress').value = parentData.Paddress;
                document.getElementById('parentID').value = parentData.parentId;  // Added this to populate the parentID
            } else {
                console.error('No parent data found in sessionStorage');
            }
        }



        // Function to set the tracking email when moving to the email section
        function setTrackingEmail(email) {
            const trackingEmailInput = document.getElementById('trackingEmail');
            trackingEmailInput.value = email; // Set the email in the input field
        }

        // Call this function with the parent's email when transitioning to the email section
        function showNextSection(sectionId) {
            const parentEmail = document.getElementById('parentEmail').value; // Get the parent's email from the parent form
            if (sectionId === 'emailSection') {
                setTrackingEmail(parentEmail); // Set the parent's email in the tracking email input
            }
            // Your existing logic to show the next section
            document.querySelectorAll('.form-section').forEach(section => section.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
        }
        // Function to validate email format
        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(String(email).toLowerCase());
        }
    </script>


    <script>
        // Define the showPrevSection function
        function showPrevSection(sectionId) {
            // Hide the current section
            const currentSection = document.querySelector('.form-section.active');
            if (currentSection) {
                currentSection.classList.remove('active');
            }

            // Show the previous section
            const prevSection = document.getElementById(sectionId);
            if (prevSection) {
                prevSection.classList.add('active');
            }
        }
    </script>


    <script>

        function updateProgress(stepId) {
            const steps = document.querySelectorAll('.progress-step');
            steps.forEach(step => step.classList.remove('active'));

            const currentStep = document.getElementById(stepId);
            if (currentStep) currentStep.classList.add('active');
        }

        function showNextSection(sectionId) {
            // Update the active form section
            const sections = document.querySelectorAll('.form-section');
            sections.forEach(section => section.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');

            // Update the progress bar based on the section
            switch (sectionId) {
                case 'agreementSection':
                    updateProgress('stepAgreement');
                    break;
                case 'parentForm':
                    updateProgress('stepParent');
                    break;
                case 'learnerForm':
                    updateProgress('stepLearner');
                    break;
                case 'emailSection':
                    updateProgress('stepTrack');
                    break;
                default:
                    updateProgress('stepSubmitted');
            }
        }

        function showPrevSection(sectionId) {
            const sections = document.querySelectorAll('.form-section');
            sections.forEach(section => section.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');

            // Update the progress bar
            switch (sectionId) {
                case 'agreementSection':
                    updateProgress('stepAgreement');
                    break;
                case 'parentForm':
                    updateProgress('stepParent');
                    break;
                case 'learnerForm':
                    updateProgress('stepLearner');
                    break;
                case 'emailSection':
                    updateProgress('stepTrack');
                    break;
            }
        }


    </script>





</body>

</html>